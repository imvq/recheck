# <img src="public/favicon.ico" height='30'> reCheck
reCheck это платформа для проверки кандидатов на работу по отзывам коллег.

## Фронтенд
#### Язык: Typescript (typescriptlang.org/docs);
#### Библиотека/фреймворк: React (reactjs.org);
#### Система управления состоянием: Redux (redux.js.org).
### Установка yarn:
```shell
$ npm install -g yarn
```
### Настройка проекта
Все команды осуществляются из-под корневой папки проекта.
Прежде, чем начать работу, необходимо установить все зависимости:
```shell
$ yarn
```
Для запуска проекта в среде разработки (предварительно должен быть запущен бэкенд):
```shell
$ yarn start
```
### Сборка
```shell
$ yarn run build
```
### Структура проекта
Весь код фронта находится в папке src, который, в свою очередь состоит из следующих каталогов (на момент составления документации):
* public: статичные файлы проекта, ссылки на которых не фигурируют в коде;
* assets: статичные файлы проекта; помещаются в эту папку, если на них необходимо ссылаться в коде;
* commons: модули, содержащие элементы, используемые во всём проекте:
    * externals: модули для работы с внешним API;
    * styles: модули для стилизации;
    * types: модули для типизации;
    * utils: вспомогательные модули.
* components: компоненты:
    * combos: объединения страниц, которые необходимо загружать вместе в случае, если была затребована одна из страниц (для оптимизации динамических импортов);
    * pages: отдельные страницы (не reusable);
    * shared: различные относительно мелкие reusable компоненты, из которых можно составлять другие;
    * App.tsx: основной компонент;
* store: Redux-хранилище.

За пределами папки src присутствуют также следующие необходимые для работы файлы (из важных):
* .env-cmdrc.json: переменные окружения.
* .eslintrc.yaml: настройки стилистики проекта;
* tsconfig.json: настройки Typescript;

### Стилистика импортов
Импорт осуществляется в следующем порядке:
1. Абсолютные.
2. Относительные.

Между собой и те и другие идут в следующем порядке:
1. Иморты сторонних библиотек.
2. Любые другие импорты, не относящиеся к компонентам (кроме имортов стилей и типов, указанных ниже).
3. Импорты компонентов.
4. Импорты стилей, типов и вспомогателных элементов в следующем порядке:
    * import * as misc from '...';
    * import * as types from '...';
    * import * as styledBase from '...';
    * import * as styledLocal from '...';
    * import * as styled from '...'.

Импорты всех трёх груп разделяются между собой одной пустой строкой. Внутри группы импорты идут в следующем порядке (разделаяются между собой пустой строкой, за исключением импортов сторонних библотек и импортов, заканчивающихся на from 'react'):
1. Импорт любого вида, заканчивающийся на from 'react'.
2. Импорты вида import * as name from '...' (между собой пустой строкой не отделяются, идут в алфавитном порядке). Импорт не сдвигается, если ПОМИМО дефолтного имени есть и деструктурированный импорт.
3. Импорты вида import name from '...' (между собой пустой строкой не отделяются, идут в алфавитном порядке).
4. Импорты вида import {name, ...} from '...' (между собой пустой строкой не отделяются, идут в алфавитном порядке).

Примечание 1. Под алфавитным порядком импортов подразумевается алфавитный порядок путей ('assets/images/pages/OwnProfilePage/...' будет идти перед 'components/pages/OwnProfilePage', а 'assets/images/pages/LandingPage/...' — перед ними обоими).

Примечание 2. Для относителных импортов сначала идут более "внешние" ('../a' будет перед './a').

### Стилистика оформления компонента
Если компонент обладает props'ами, типы для них оформляются в отдельном файле ./types.ts, в котором указывается три значения:
* export interface IOwnProps: собственные props'ы;
* export interface IStateProps: props'ы для считывания данных с хранилища;
* export interface IDispatchProps: props'ы для изменения данных хранилища.

Из перечисленных экспортов обязан присутствовать хотя бы один, также обязательно указывается type IProps, который является объединением всех трёх типов (либо двух, либо же IProps указывается как псевдоним для одного из них, если из перечисленных выше экспортов присутствует всего один).

Стилевые компоненты, из котороых состоит текущий, декларируются в отдельном файле ./styled.ts.

Вспомогательные объекты и функции можно выносить для удобства в отдельный файл ./misc.ts.

## Бэкенд
#### Платформа: Node.js (nodejs.org/en/download);
#### Язык: Typescript (см. [Фронтенд](#фронтенд));
#### Фреймоврки:
1. Express (expressjs.com);
2. Typescript-Rest (github.com/thiagobustamante/typescript-rest#readme).
#### База данных: PostgreSQL 12.7 (postgresql.org/files/documentation/pdf/12/postgresql-12-A4.pdf);
#### ORM: TypeORM (typeorm.io).

## Установка
### Установка Node.js:
macOS, Windows, Linux: nodejs.org/en/download/package-manager
### Установка локальной версии PostgreSQL для разработки:
#### macOS: postgresqltutorial.com/install-postgresql-macos
#### Windows: postgresqltutorial.com/install-postgresql
#### Linux: postgresqltutorial.com/install-postgresql-linux
### Настройка проекта
Корневая папка кода бэкенда: api, все команды осуществляются из-под неё.

Прежде, чем начать работу, необходимо установить все зависимости:
```shell
$ yarn
```
Или же (если yarn не был установлен):
```shell
$ npm install
```
Прежде чем выполнить первый запуск, необходимо подготовить необходимые файлы (здесь и далее вместо yarn можно использовать npm):
```shell
$ yarn run prepare-all
```
Хоть исходный код проекта написан с использованием Typescript, то, что исполняется в итоге — это код на чистом Javascript, в который и компилируется исходный код. Поэтому прежде чем запустить проект, исходный код должен быть скомпилирован. В режиме разработки при каждом изменении файлов проекта, весь код автоматически компилируется, а результат помещается в папку dist. Важное примечание: в эту папку попадает <strong>любой</strong> скомпилированный код, то есть как тот, что генерируется в режиме разработки, так и тот, что генерируется при выполнении команды сборки production-версии. По этой причине сборку production-версии рекомендуется осуществлять непосредственно на рабочем сервере, поскольку код, сгенерированный смешанными командами, не будет работать корректно.

Для работы сервера необходим доступный порт (по умолчанию 8081, можно поменять в .env.development), а также запущенный postresql-сервер. В СУБД должен существовать пользователь recheck и одноимённая база данных.

Также необходимо наличие всех выполненных миграций базы данных. Миграции осуществляются с помощью возможностей, предоставляемых TypeORM.

Последовательность шагов, необходимых для осуществления миграций:
1. Миграции должны быть скомпилированы в Javascript (ограничение TypeORM, миграция может осуществляться лишь из скомпилированного кода) и находиться в соответствующем каталоге внутри dist (папка с генерируемым кодом проекта).
2. Далее следует комадна для запуска миграций:
```shell
$ yarn run migration:run
```
В дальнейшем чтобы создать новую миграцию необхоимо выполнить следующие шаги:
1. Внести изменения в сущности (каталог database/entities).
2. Собрать проект.
3. Осуществить следующую команду:
```shell
$ yarn run migration:generate -n 'Название миграции'
```
4. Повторно (!) собрать проект.
5. Выполнить миграцию как и в случае перенесения:
```shell
$ yarn run migration:run
```
Запуск сервера разработки:
```shell
$ yarn dev
```
Примечание: для npm команда будет выглядеть как npm run dev.
При успешном запуске будет вывод в консоль
```shell
XX:XX:XX XX - Found 0 errors. Watching for file changes.
Watching session started
Logger activated
[LOG]: Listening to localhost:8081
[LOG]: Database connection established
```
Для проверки работы API можно сделать запрос на следующий адрес: /api/v1/health:
```shell
$ curl localhost:8081/api/v1/health
```
ответом должно быть сообщение наподобие
```shell
{"message":"Server is running","version":"1.0.0"}
```
Все изменения в файлах провоцируют перекомпиляцию проекта. О начале перекомпиляции свидетельствует вывод в консоль:
```shell
XX:XX:XX XX - Found 0 errors. Watching for file changes.
Previous Process killed with SIGINT signal. Please, wait until recompiled
```
В момент перекомпиляции до её завершения сервер разработки недоступен (запросы к API не будут проходить).
### Переменные окружения
Для переменных окрыжения должны быть созданы отдельные файлы (.env.development и .env.production), примеры файлов со всеми необходимыми переменными есть в корневой папке бэкенда.
### Структура проекта
Весь код бэкенда находится в папке src, который, в свою очередь состоит из следующих каталогов (на момент составления документации):
* application: основная папка с классом, инкапсулирующим всю логику приложения; также здесь находиться исполняемый скрипт запуска сервера;
* commons: reusable-модули, для использования во всём проекте;
* controllers: контроллеры (примечание: контроллеры с точки зрения MVC в терминах typescript-rest носят название "сервисы", поэтому метод класса Server для их загрузки носит название loadServices. <strong>Изменено:</strong> для метода loadServices был добавлен псевдоним loadControllers, рекомендуется использвать его для более корректной передачи смысла);
* database: каталог с сущностями базы данных; также здесь хранятся настройки для подключения к СУБД;
* dto: каталог хранения описания data transfer objects (непосредственно экземляры этих классов используются для автоматической проверки тел входящих запросов и для агрегации передаваемых данных для более удобной работы с ними в рамках приложения);
* logging: код для работы с логированием во время разработки;
* services: бизнес-логика приложения.
* typing: типы данных, используемые в приложении, не являющиеся DTO.
* utils: мелкие впомогательные функции.
* dev-watch.ts необходим для работы перекомпиляции в реальном времени.

За пределами папки src присутствуют также следующие необходимые для работы файлы:
* .env.*: переменные окружения;
* .eslintrc.yaml: настройки стилистики проекта;
* pm2ecosystem.generate.js: скрипт для создания конфигурационного файла, используемого на рабочем сервере (pm2.keymetrics.io);
* rest.config: файл, необходимы для корректной работы декораторов typescript-rest (без понятия, что конкретно он делает, но без него всё ломается, просто не нужно его трогать, и всё ^_^);
* swagger.config.json: настройки Swagger;
* tsconfig.json: настройки Typescript;
* npmrc: нужен для корректной работы скриптов под Windows.
### Swagger

API описана с помощью Swagger. При выполнении команды
```shell
$ yarn run prepare-swagger
```
будет получена актуальная схема API, которую можно в дальнейшем протестировать (swagger.io).
### Сборка
```shell
$ yarn run build
```
Для дальнейшей разработки, если уже была выполнена команда yarn run build, желательно удалить папку dist и не забыть подготовить её заново с помощью yarn run prepare-all.
