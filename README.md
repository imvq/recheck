# <img src="public/favicon.ico" height='30'> reCheck
reCheck это платформа для проверки кандидатов на работу по отзывам коллег.

## Бэкенд
#### Платформа: Node.js (nodejs.org/en/download)
#### Язык: Typescript (typescriptlang.org/docs)
#### Фреймоврки:
1. Express (expressjs.com)
2. Typescript-Rest (github.com/thiagobustamante/typescript-rest#readme)
#### База данных: PostgreSQL 12.7 (postgresql.org/files/documentation/pdf/12/postgresql-12-A4.pdf)
#### ORM: TypeORM (typeorm.io)

## Установка
### Установка Node.js:
macOS, Windows, Linux: nodejs.org/en/download/package-manager/
### Установка yarn:
```shell
$ npm install -g yarn
```
### Установка локальной версии PostgreSQL для разработки:
#### macOS: postgresqltutorial.com/install-postgresql-macos
#### Windows: postgresqltutorial.com/install-postgresql
#### Linux: postgresqltutorial.com/install-postgresql-linux
### Настройка проекта
Корневая папка кода бэкенда: api, все команды осуществляются из-под неё.

Прежде, чем начать работу, необходимо установить все зависимости:
```shell
$ yarn
```
Или же (если yarn не был установлен):
```shell
$ npm install
```
Прежде чем выполнить первый запуск, необходимо подготовить необходимые файлы (здесь и далее вместо yarn можно использовать npm):
```shell
$ yarn run prepare-all
```
Хоть исходный код проекта написан с использованием Typescript, то, что исполняется в итоге — это код на чистом Javascript, в который и компилируется исходный код. Поэтому прежде чем запустить проект, исходный код должен быть скомпилирован. В режиме разработки при каждом изменении файлов проекта, весь код автоматически компилируется, а результат помещается в папку dist. Важное примечание: в эту папку попадает <strong>любой</strong> скомпилированный код, то есть как тот, что генерируется в режиме разработки, так и тот, что генерируется при выполнении команды сборки production-версии. По этой причине сборку production-версии рекомендуется осуществлять непосредственно на рабочем сервере, поскольку код, сгенерированный смешанными командами, не будет работать корректно.

Для работы сервера необходим доступный порт (по умолчанию 8081, можно поменять в .env.development), а также запущенный postresql-сервер. В СУБД должен существовать пользователь recheck и одноимённая база данных.

Также необходимо наличие всех выполненных миграций базы данных. Миграции осуществляются с помощью возможностей, предоставляемых TypeORM.

Последовательность шагов, необходимых для осуществления миграций:
1. Миграции должны быть скомпилированы в Javascript (ограничение TypeORM, миграция может осуществляться лишь из скомпилированного кода) и находиться в соответствующем каталоге внутри dist (папка с генерируемым кодом проекта).
2. Далее следует комадна для запуска миграций:
```shell
$ yarn run migration:run
```
В дальнейшем чтобы создать новую миграцию необхоимо выполнить следующие шаги:
1. Внести изменения в сущности (каталог database/entities).
2. Собрать проект.
3. Осуществить следующую команду:
```shell
$ yarn run migration:generate -n 'Название миграции'
```
4. Повторно (!) собрать проект.
5. Выполнить миграцию как и в случае перенесения:
```shell
$ yarn run migration:run
```
Запуск сервера разработки:
```shell
$ yarn dev
```
Примечание: для npm команда будет выглядеть как npm run dev.
При успешном запуске будет вывод в консоль
```shell
XX:XX:XX XX - Found 0 errors. Watching for file changes.
Watching session started
Logger activated
[LOG]: Listening to localhost:8081
[LOG]: Database connection established
```
Для проверки работы API можно сделать запрос на следующий адрес: /api/v1/health:
```shell
$ curl localhost:8081/api/v1/health
```
ответом должно быть сообщение наподобие
```shell
{"message":"Server is running","version":"1.0.0"}
```
Все изменения в файлах провоцируют перекомпиляцию проекта. О начале перекомпиляции свидетельствует вывод в консоль:
```shell
XX:XX:XX XX - Found 0 errors. Watching for file changes.
Previous Process killed with SIGINT signal. Please, wait until recompiled
```
В момент перекомпиляции до её завершения сервер разработки недоступен (запросы к API не будут проходить).
### Переменные окружения
Для переменных окрыжения должны быть созданы отдельные файлы (.env.development и .env.production), примеры файлов со всеми необходимыми переменными есть в корневой папке бэкенда.
### Структура проекта
Весь код бэкенда находится в папке src, который, в свою очередь состоит из следующих каталогов (на момент составления документыции):
- application: основная папка с классом, инкапсулирующим всю логику приложения; также здесь находиться исполняемый скрипт запуска сервера;
- common: reusable-модули, для использования во всём проекте;
- controllers: контроллеры (примечание: контроллеры с точки зрения MVC в терминах typescript-rest носят название "сервисы", поэтому метод класса Server для их загрузки носит название loadServices. <strong>Изменено:</strong> для метода loadServices был добавлен псевдоним loadControllers, рекомендуется использвать его для более корректной передачи смысла);
- database: каталог с сущностями базы данных; также здесь хранятся настройки для подключения к СУБД;
- dto: каталог хранения описания data transfer objects (непосредственно экземляры этих классов используются для автоматической проверки тел входящих запросов и для агрегации передаваемых данных для более удобной работы с ними в рамках приложения);
- logging: код для работы с логированием во время разработки;
- services: бизнес-логика приложения.
- typing: типы данных, используемые в приложении, не являющиеся DTO.
- utils: мелкие впомогательные функции.
- dev-watch.ts необходим для работы перекомпиляции в реальном времени.

За пределами папки src присутствуют также следующие необходимые для работы файлы:
- pm2ecosystem.generate.js: скрипт для создания конфигурационного файла, используемого на рабочем сервере (pm2.keymetrics.io);
- rest.config: файл, необходимы для корректной работы декораторов typescript-rest (без понятия, что конкретно он делает, но без него всё ломается, просто не нужно его трогать, и всё ^_^);
- swagger.config.json: настройки Swagger;
- tsconfig.json: настройки Typescript.
### Swagger

API описана с помощью Swagger. При выполнении команды
```shell
$ yarn run prepare-swagger
```
будет получена актуальная схема API, которую можно в дальнейшем протестировать (swagger.io).
### Сборка
```shell
$ yarn run build
```
Для дальнейшей разработки, если уже была выполнена команда yarn run build, желательно удалить папку dist и не забыть подготовить её заново с помощью yarn run prepare-all.
